//@version=5
strategy(title="TRIX Strategy Short", shorttitle="TRIX Short", overlay=true)

// Input for the length of the TRIX calculation
length = input.int(12, minval=1)

// Calculate TRIX
trixValue = 10000 * ta.change(ta.ema(ta.ema(ta.ema(math.log(close), length), length), length))

// Alert condition for TRIX crossing above 1
crossAboveOne = ta.crossunder(trixValue, 1.2)

// Strategy entry for short positions
if (crossAboveOne)
    strategy.entry("Short", strategy.short, qty = 4)

// Get the entry price
var float entryPrice = na
if (strategy.position_size < 0)
    entryPrice := strategy.opentrades.entry_price(0)

// Define take profit and stop loss levels
takeProfitLevel1 = entryPrice - 4
takeProfitLevel2 = entryPrice - 12
initialStopLoss = entryPrice + 20
finalStopLoss = entryPrice + 2

// Strategy exit for short positions with trailing stop
if (strategy.position_size < 0)
    strategy.exit("Exit Short1", "Short", limit=takeProfitLevel1, stop=initialStopLoss, qty = 3)
    strategy.exit("Exit Short2", "Short", limit=takeProfitLevel2, stop=finalStopLoss, qty = 1)
